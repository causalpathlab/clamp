% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/clamp_categorical.R
\name{clamp_categorical}
\alias{clamp_categorical}
\title{CLAMP for categorical exposure variables.}
\usage{
clamp_categorical(
  X,
  y,
  W = NULL,
  maxL = min(10, ncol(X)),
  scaled_prior_variance = 0.2,
  residual_variance = NULL,
  prior_inclusion_prob = NULL,
  standardize = FALSE,
  intercept = TRUE,
  estimate_residual_variance = TRUE,
  estimate_prior_variance = TRUE,
  estimate_prior_method = c("optim", "EM", "simple"),
  check_null_threshold = 0,
  causal_effect_estimator = c("mHT"),
  variance_estimator = c("bootstrap"),
  nboots = 100,
  seed = NULL,
  burn_in = 10,
  converge_window = 10,
  prior_tol = 1e-09,
  residual_variance_upperbound = Inf,
  abnormal_proportion = 0.5,
  robust_method = c("none", "huber"),
  robust_estimator = c("M", "S"),
  coverage = 0.95,
  min_abs_corr = 0.5,
  na.rm = FALSE,
  max_iter = 200,
  tol = 0.01,
  verbose = FALSE,
  track_fit = FALSE,
  residual_variance_lowerbound = var(drop(y))/10000,
  n_purity = 100
)
}
\arguments{
\item{X}{An n by p matrix of covariates. X should be either one-hot encoded.
If not, then each column of X would be considered as factors.}

\item{y}{The observed responses, a vector of length n.}

\item{W}{The weight matrix of size (n by p-levels) or a n-dim vector.
By default, \code{W=NULL}. Each column of W, which should be named in the
format of \emph{"variable_level"}, represents the inverse
probability weight of a specific level of a variable. It should have the
same size as the one-hot encoded version of X.}

\item{maxL}{Maximum number of non-zero effects in the susie
regression model. If L is larger than the number of covariates, p,
L is set to p.}

\item{scaled_prior_variance}{The prior variance, divided by
\code{var(y)} (or by \code{(1/(n-1))yty} for
\code{susie_suff_stat}); that is, the prior variance of each
non-zero element of b is \code{var(y) * scaled_prior_variance}. The
value provided should be either a scalar or a vector of length
\code{L}. If \code{estimate_prior_variance = TRUE}, this provides
initial estimates of the prior variances.}

\item{residual_variance}{Variance of the residual. If
\code{estimate_residual_variance = TRUE}, this value provides the
initial estimate of the residual variance. By default, it is set to
\code{var(y)} in \code{clamp} and \code{(1/(n-1))yty} in
\code{susie_suff_stat}.}

\item{prior_inclusion_prob}{A vector of length p, in which each entry
gives the prior probability that corresponding column of X has a
nonzero effect on the outcome, y.}

\item{standardize}{If \code{standardize = TRUE}, standardize the
columns of X to unit variance prior to fitting (or equivalently
standardize XtX and Xty to have the same effect). Note that
\code{scaled_prior_variance} specifies the prior on the
coefficients of X \emph{after} standardization (if it is
performed). If you do not standardize, you may need to think more
carefully about specifying \code{scaled_prior_variance}. Whatever
your choice, the coefficients returned by \code{coef} are given for
\code{X} on the original input scale. Any column of \code{X} that
has zero variance is not standardized.}

\item{intercept}{If \code{intercept = TRUE}, the intercept is
fitted; it \code{intercept = FALSE}, the intercept is set to
zero. Setting \code{intercept = FALSE} is generally not
recommended.}

\item{estimate_residual_variance}{If
\code{estimate_residual_variance = TRUE}, the residual variance is
estimated, using \code{residual_variance} as an initial value. If
\code{estimate_residual_variance = FALSE}, the residual variance is
fixed to the value supplied by \code{residual_variance}.}

\item{estimate_prior_variance}{If \code{estimate_prior_variance =
  TRUE}, the prior variance is estimated (this is a separate
parameter for each of the L effects). If provided,
\code{scaled_prior_variance} is then used as an initial value for
the optimization. When \code{estimate_prior_variance = FALSE}, the
prior variance for each of the L effects is determined by the
value supplied to \code{scaled_prior_variance}.}

\item{estimate_prior_method}{The method used for estimating prior
variance. When \code{estimate_prior_method = "simple"} is used, the
likelihood at the specified prior variance is compared to the
likelihood at a variance of zero, and the setting with the larger
likelihood is retained.}

\item{check_null_threshold}{When the prior variance is estimated,
compare the estimate with the null, and set the prior variance to
zero unless the log-likelihood using the estimate is larger by this
threshold amount. For example, if you set
\code{check_null_threshold = 0.1}, this will "nudge" the estimate
towards zero when the difference in log-likelihoods is small. A
note of caution that setting this to a value greater than zero may
lead the IBSS fitting procedure to occasionally decrease the ELBO.}

\item{burn_in}{A number, referring to the number of initial iterations
being discarded. It is used to check the convergence when
\code{mle_variance_estimator="bootstrap"}. Some pilot simulations are
recommended to determine the burn-in period.}

\item{converge_window}{A number. If, after the burn-in period, the
average of ELBO of \code{converge_window} successive iterations converges,
then the algorithm is considered converged.}

\item{prior_tol}{When the prior variance is estimated, compare the
estimated value to \code{prior_tol} at the end of the computation,
and exclude a single effect from PIP computation if the estimated
prior variance is smaller than this tolerance value.}

\item{residual_variance_upperbound}{Upper limit on the estimated
residual variance. It is only relevant when
\code{estimate_residual_variance = TRUE}.}

\item{abnormal_proportion}{a value between 0 and 1. If the number of detected
abnormal subjects exceeds \eqn{abnormal_proportion * nrow(X)},}

\item{robust_method}{A string, whether and which robust method is applied
when fitting the model. \code{robust_method="none"} specifies that no
robust method is applied. \code{robust_method="huber"} specifies that the
Huber weighting method is applied.}

\item{robust_estimator}{A string, which robust estimator is applied.
\code{robust_estimator="M"} indicates the M-estimator is applied, and
\code{robust_estimator="S"} indicates the S-estimator is applied.}

\item{coverage}{A number between 0 and 1 specifying the
\dQuote{coverage} of the estimated confidence sets.}

\item{min_abs_corr}{Minimum absolute correlation allowed in a
credible set. The default, 0.5, corresponds to a squared
correlation of 0.25, which is a commonly used threshold for
genotype data in genetic studies.}

\item{na.rm}{Drop any missing values in y from both X and y.}

\item{max_iter}{Maximum number of IBSS iterations to perform.}

\item{tol}{A small, non-negative number specifying the convergence
tolerance for the IBSS fitting procedure. The fitting procedure
will halt when the difference in the variational lower bound, or
\dQuote{ELBO} (the objective function to be maximized), is
less than \code{tol}.}

\item{verbose}{If \code{verbose = TRUE}, the algorithm's progress,
and a summary of the optimization settings, are printed to the
console.}

\item{track_fit}{If \code{track_fit = TRUE}, \code{trace}
is also returned containing detailed information about the
estimates at each iteration of the IBSS fitting procedure.}

\item{residual_variance_lowerbound}{Lower limit on the estimated
residual variance. It is only relevant when
\code{estimate_residual_variance = TRUE}.}

\item{n_purity}{Passed as argument \code{n_purity} to
\code{\link{clamp_get_cs}}.}

\item{family}{A description of error distribution and link function used in
the model. \code{family="linear"} stands for a linear regression model
with identity link, \code{family="logistic"} stands for a logistic
regression model, and \code{family="poisson"} stands for a Poisson
regression model.}

\item{mle_variance_estimator}{The method to estimate the variances of
IPW estimators. \code{"bootstrap"} estimates the variance via 100
bootstrap replicates, \code{"sandwich"} computes the robust sandwich
variance estimates, and \code{"naive"} calculates the variances based
on the corresponding weighted linear regression models.}
}
\value{
A \code{"clamp"} object with some or all of the following
elements:

\item{alpha}{An maxL by p matrix of posterior inclusion probabilites.}

\item{mu}{An maxL by p matrix of posterior means, conditional on
inclusion.}

\item{mu2}{An maxL by p matrix of posterior second moments,
conditional on inclusion.}

\item{deltahat}{An maxL by p matrix of maximum likelihood estimator,
conditional on inclusion.}

\item{Xr}{A vector of length n, equal to \code{X \%*\% colSums(alpha
  * mu)}.}

\item{logBF}{log-Bayes Factor for each single effect.}

\item{logBF_variable}{log-Bayes Factor for each variable and single effect.}

\item{intercept}{Intercept (fixed or estimated).}

\item{sigma2}{Residual variance (fixed or estimated).}

\item{prior_varD}{Prior variance of the non-zero elements of b, equal to
\code{scaled_prior_variance * var(y)}.}

\item{elbo}{The value of the variational lower bound, or
\dQuote{ELBO} (objective function to be maximized), achieved at
each iteration of the IBSS fitting procedure.}

\item{importance_weight}{A vector of length n containing the importance
weights computed when applying the robust methods (or all 1 if
\code{robust_method="none"}.)}

\item{fitted}{A vector of length n containing the fitted values of
the outcome.}

\item{sets}{Credible sets estimated from model fit; see
\code{\link{clamp_get_cs}} for details.}

\item{pip}{A vector of length p giving the (marginal) posterior
inclusion probabilities for all p covariates.}

\item{z}{A vector of univariate z-scores.}

\item{niter}{Number of IBSS iterations that were performed.}

\item{converged}{\code{TRUE} or \code{FALSE} indicating whether
the IBSS converged to a solution within the chosen tolerance
level.}
}
\description{
CLAMP for categorical exposure variables.
}
